
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>The Ray Tracing Routines &#8212; QSOFT 9.0 documentation</title>
    <link rel="stylesheet" href="_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="New Surface Elements" href="xsrt_new_surfaces.html" />
    <link rel="prev" title="Module Source Code" href="qsoft_source_code.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="xsrt_new_surfaces.html" title="New Surface Elements"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="qsoft_source_code.html" title="Module Source Code"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">QSOFT 9.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="qsoft_modifying.html" accesskey="U">Adding New Functions</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="the-ray-tracing-routines">
<h1>The Ray Tracing Routines<a class="headerlink" href="#the-ray-tracing-routines" title="Permalink to this headline">Â¶</a></h1>
<p>The driving routine, which is called by the interface routine
QRT_TRACE is SRT_TRACE. Within this routine there are two loops.
The outer loop is definite and works through the NRAYS which are
to be generated by the source.
The inner loop is indefinite and traces each ray through the surface elements.
The next surface in the sequence is determined by the outcome of encounters
with elements and multiple reflections between surfaces are allowed.
This inner loop is terminated when the ray is absorbed, detected or
finally misses the last element in the sequence.</p>
<p>Each surface element type is specified by an index as listed in this table:</p>
<table border="1" class="docutils">
<colgroup>
<col width="3%" />
<col width="11%" />
<col width="11%" />
<col width="15%" />
<col width="23%" />
<col width="17%" />
<col width="14%" />
<col width="6%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">#</th>
<th class="head">surface</th>
<th class="head">form</th>
<th class="head">deform</th>
<th class="head">limits</th>
<th class="head">single/nest</th>
<th class="head">code</th>
<th class="head">ikon</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>1</td>
<td>plane</td>
<td>open</td>
<td>normal</td>
<td>cartesian</td>
<td>single</td>
<td>plna</td>
<td>1</td>
</tr>
<tr class="row-odd"><td>2</td>
<td>plane</td>
<td>open</td>
<td>normal</td>
<td>radial</td>
<td>single</td>
<td>plna</td>
<td>2</td>
</tr>
<tr class="row-even"><td>3</td>
<td>plane</td>
<td>open</td>
<td>radial</td>
<td>radial</td>
<td>single</td>
<td>plna</td>
<td>3</td>
</tr>
<tr class="row-odd"><td>4</td>
<td>plane</td>
<td>open</td>
<td>radial</td>
<td>radial</td>
<td>nested</td>
<td>plna</td>
<td>-n</td>
</tr>
<tr class="row-even"><td>5</td>
<td>plane</td>
<td>closed</td>
<td>normal</td>
<td>cartesian</td>
<td>single</td>
<td>plne</td>
<td>1</td>
</tr>
<tr class="row-odd"><td>6</td>
<td>plane</td>
<td>closed</td>
<td>normal</td>
<td>radial</td>
<td>single</td>
<td>plne</td>
<td>2</td>
</tr>
<tr class="row-even"><td>7</td>
<td>plane</td>
<td>closed</td>
<td>radial</td>
<td>radial</td>
<td>single</td>
<td>plne</td>
<td>3</td>
</tr>
<tr class="row-odd"><td>8</td>
<td>plane</td>
<td>closed</td>
<td>radial</td>
<td>radial</td>
<td>nested</td>
<td>plne</td>
<td>-n</td>
</tr>
<tr class="row-even"><td>9</td>
<td>conic</td>
<td>grazing</td>
<td>radial</td>
<td>axial</td>
<td>single</td>
<td>cnic</td>
<td>1</td>
</tr>
<tr class="row-odd"><td>10</td>
<td>conic</td>
<td>normal</td>
<td>axial</td>
<td>radial</td>
<td>single</td>
<td>cnin</td>
<td>1</td>
</tr>
<tr class="row-even"><td>11</td>
<td>conic</td>
<td>normal</td>
<td>axial</td>
<td>cartesian</td>
<td>single</td>
<td>cnin</td>
<td>2</td>
</tr>
<tr class="row-odd"><td>12</td>
<td>sphere</td>
<td>grazing</td>
<td>radial</td>
<td>cartesian</td>
<td>single</td>
<td>sphr</td>
<td>1</td>
</tr>
<tr class="row-even"><td>13</td>
<td>sphere</td>
<td>grazing</td>
<td>radial</td>
<td>radial</td>
<td>single</td>
<td>sphr</td>
<td>2</td>
</tr>
<tr class="row-odd"><td>14</td>
<td>sphere</td>
<td>normal</td>
<td>radial</td>
<td>cartesian</td>
<td>single</td>
<td>sphr</td>
<td>3</td>
</tr>
<tr class="row-even"><td>15</td>
<td>sphere</td>
<td>normal</td>
<td>radial</td>
<td>radial</td>
<td>single</td>
<td>sphr</td>
<td>4</td>
</tr>
<tr class="row-odd"><td>16</td>
<td>conic</td>
<td>normal</td>
<td>azimuthal</td>
<td>cartesian</td>
<td>single</td>
<td>cnin</td>
<td>3</td>
</tr>
<tr class="row-even"><td>17</td>
<td>plane</td>
<td>open</td>
<td>normal</td>
<td>azimuthal</td>
<td>single</td>
<td>plna</td>
<td>4</td>
</tr>
<tr class="row-odd"><td>18</td>
<td>plane</td>
<td>open</td>
<td>normal</td>
<td>cartesian grid</td>
<td>single</td>
<td>plna</td>
<td>6</td>
</tr>
<tr class="row-even"><td>19</td>
<td>conic</td>
<td>grazing</td>
<td>radial</td>
<td>axial+azimuthal</td>
<td>single</td>
<td>cnic</td>
<td>2</td>
</tr>
<tr class="row-odd"><td>20</td>
<td>plane</td>
<td>closed</td>
<td>normal</td>
<td>cartesian slat</td>
<td>single</td>
<td>plna</td>
<td>7</td>
</tr>
<tr class="row-even"><td>21</td>
<td>sphere</td>
<td>pore</td>
<td>normal</td>
<td>pore</td>
<td>multiple</td>
<td>sphr+pore</td>
<td>5</td>
</tr>
<tr class="row-odd"><td>22</td>
<td>plane</td>
<td>open</td>
<td>normal</td>
<td>sector</td>
<td>single</td>
<td>plna</td>
<td>8</td>
</tr>
<tr class="row-even"><td>23</td>
<td>conic</td>
<td>moa</td>
<td>radial</td>
<td>axial+azimuthal</td>
<td>multiple</td>
<td>cnic</td>
<td>3</td>
</tr>
<tr class="row-odd"><td>24</td>
<td>plane</td>
<td>Sipores</td>
<td>normal</td>
<td>pore</td>
<td>multiple</td>
<td>plna</td>
<td>9</td>
</tr>
<tr class="row-even"><td>25</td>
<td>plane</td>
<td>KBstack</td>
<td>normal</td>
<td>slots</td>
<td>multiple</td>
<td>plna</td>
<td>9</td>
</tr>
<tr class="row-odd"><td>26</td>
<td>conic</td>
<td>normal</td>
<td>normal</td>
<td>axial+azimuthal</td>
<td>single</td>
<td>cnic</td>
<td>3</td>
</tr>
<tr class="row-even"><td>27</td>
<td>plane</td>
<td>open</td>
<td>normal</td>
<td>parallelogram</td>
<td>single</td>
<td>plna</td>
<td>10</td>
</tr>
<tr class="row-odd"><td>28</td>
<td>sphere</td>
<td>MPOarr</td>
<td>normal</td>
<td>pore</td>
<td>multiple</td>
<td>sphr+arr</td>
<td>5</td>
</tr>
<tr class="row-even"><td>29</td>
<td>plane</td>
<td>MPOtest</td>
<td>normal</td>
<td>pore</td>
<td>single</td>
<td>plna</td>
<td>11</td>
</tr>
<tr class="row-odd"><td>30</td>
<td>plane</td>
<td>SPOarr</td>
<td>normal</td>
<td>pore</td>
<td>multiple</td>
<td>plna</td>
<td>9</td>
</tr>
<tr class="row-even"><td>31</td>
<td>sphere</td>
<td>Schmidt</td>
<td>normal</td>
<td>slot</td>
<td>multiple</td>
<td>sle</td>
<td>5</td>
</tr>
<tr class="row-odd"><td>32</td>
<td>plane</td>
<td>Schmidt</td>
<td>normal</td>
<td>slot</td>
<td>multiple</td>
<td>plns</td>
<td>1</td>
</tr>
</tbody>
</table>
<p>Each of these surface types has a subroutine SRT_SUnn associated with
it where nn is the type index. These routines call 1 of 13 routines which
find the intersection of rays with a plane, sphere, conic, square pores,
MOA slots, Si pores, Si pore array, K-B stack slots or Schmidt lobster stacks.
The pore and slot routines set up the parameters for 4 plane surfaces
which are then serviced by the SRT_PLNE routine or SRT_PLNS.
The Si pore routine
sets up the parameters for 8 plane surfaces to define the 1st and
2nd section of the Si pore.</p>
<table border="1" class="docutils">
<colgroup>
<col width="31%" />
<col width="69%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>SRT_PLNA</td>
<td>aperture on plane surface</td>
</tr>
<tr class="row-even"><td>SRT_PLNE</td>
<td>plane surface</td>
</tr>
<tr class="row-odd"><td>SRT_CNIC</td>
<td>conic at grazing incidence</td>
</tr>
<tr class="row-even"><td>SRT_CNIN</td>
<td>conic at normal incidence</td>
</tr>
<tr class="row-odd"><td>SRT_SPHR</td>
<td>spherical surface</td>
</tr>
<tr class="row-even"><td>SRT_PORE</td>
<td>square pore</td>
</tr>
<tr class="row-odd"><td>SRT_MOA</td>
<td>moa slots</td>
</tr>
<tr class="row-even"><td>SRT_SIPORE</td>
<td>Si pores</td>
</tr>
<tr class="row-odd"><td>SRT_KBS</td>
<td>Kirpatrick-Baez stack</td>
</tr>
<tr class="row-even"><td>SRT_PLNS</td>
<td>Schmidt version of PLNE</td>
</tr>
<tr class="row-odd"><td>SRT_SLE</td>
<td>Schmidt lobster stack</td>
</tr>
<tr class="row-even"><td>SRT_SPOARR</td>
<td>Si pores module array</td>
</tr>
<tr class="row-odd"><td>SRT_SQMPOARR</td>
<td>Square pore MPO array</td>
</tr>
</tbody>
</table>
<p>The combination of form, deformation, limits and single/nested used in each
of these routines is set by the integer argument IKON (see table above).
Full details about
these configurations and the parameters which they use are given in the
comments at the start of the code for each routine.</p>
<p>All the surface element parameters etc. are held in a common area. Individual
surface elements pick up their parameters using an index into this area.
The parameters are set by the following routines:</p>
<table border="1" class="docutils">
<colgroup>
<col width="21%" />
<col width="28%" />
<col width="51%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">routine</th>
<th class="head">parameters</th>
<th class="head">called by</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>SRT_SETF</td>
<td>surface</td>
<td>QRT_MIRROR, QRT_BAFFLE etc.</td>
</tr>
<tr class="row-odd"><td>SRT_SETT</td>
<td>surface quality</td>
<td>QRT_SURFACE, QRT_LENS, QRT_PRISM</td>
</tr>
<tr class="row-even"><td>SRT_SETD</td>
<td>deformation</td>
<td>QRT_DEFS</td>
</tr>
<tr class="row-odd"><td>SRT_SETS</td>
<td>source</td>
<td>QRT_SOURCE</td>
</tr>
<tr class="row-even"><td>SRT_SETCONCOM</td>
<td>SPO constellation</td>
<td>QRT_SIPORE</td>
</tr>
<tr class="row-odd"><td>SRT_SETKBSCOM</td>
<td>KBS constellation</td>
<td>QRT_KBS</td>
</tr>
<tr class="row-even"><td>SRT_SETMPOARR</td>
<td>MPO array</td>
<td>QRT_SQMPOARR</td>
</tr>
<tr class="row-odd"><td>SRT_SETSLECOM</td>
<td>Schmidt lobster eye</td>
<td>QRT_SLE</td>
</tr>
<tr class="row-even"><td>SRT_SETSPOCOM</td>
<td>Si Pore Optics</td>
<td>QRT_SPOARR</td>
</tr>
</tbody>
</table>
<p>These routines put the parameters
into common blocks. The order of the parameters is important and must
match the order expected by the target routine. The sequence of
parameters expected is specified in the comment lines at the top
of the surface element routines.</p>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h3><a href="index.html">Table of Contents</a></h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Build and Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="using_py_R_IDL.html">Python, R and IDL</a></li>
<li class="toctree-l1"><a class="reference internal" href="qfits.html">qfits - Using FITS Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="images.html">images  - Image Processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="astro.html">astro  - Astronomy Applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="xscat.html">xscat  - X-ray Physics</a></li>
<li class="toctree-l1"><a class="reference internal" href="xsrt.html">xsrt   - Sequential Ray Tracing</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="qsoft_modifying.html">Adding New Functions</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="qsoft_source_code.html">Module Source Code</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">The Ray Tracing Routines</a></li>
<li class="toctree-l2"><a class="reference internal" href="xsrt_new_surfaces.html">New Surface Elements</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="qsoft_source_code.html"
                        title="previous chapter">Module Source Code</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="xsrt_new_surfaces.html"
                        title="next chapter">New Surface Elements</a></p>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="xsrt_new_surfaces.html" title="New Surface Elements"
             >next</a> |</li>
        <li class="right" >
          <a href="qsoft_source_code.html" title="Module Source Code"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">QSOFT 9.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="qsoft_modifying.html" >Adding New Functions</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2018, Richard Willingale.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.1.
    </div>
  </body>
</html>